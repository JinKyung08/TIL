# Day 02

## -- Cloud --

### ▷ Docker

1. 도커의 구조와 특징

- 도커(Docker)
  - 애플리케이션을 **개발/배포/실행**하기 위한 플랫폼
  - 컨테이너를 사용하여 애플리케이션 및 지원 구성 요소 개발
  - 프로세스 단위의 **격리 환경**을 제공
  - 성능 손실을 최소화 
- 도커 엔진과 도커 데몬(dockerd)
  - Docker 객체와 서비스들을 관리
  - 도커 데몬 - 도커 프로세스가 실행되어 입력 받을 준비가 된 상태
- 도커 클라이언트(docker)
  - 명령어를 Docker API 형태로 도커 데몬에게 전달
- 도커 레지스트리(Registry)
  - 이미지들을 저장하고 공유해주는 원격 저장소



2. 도커 이미지 관리하기

- 도커 이미지

  - 컨테이너를 만들고 실행하기 위한 읽기 전용 파일(템플릿)
  - 모든 컨테이너는 이미지 기반으로 생성

- 도커 이미지와 컨테이너

  - 컨테이너는 필요한 파일과 설정을 이미지에서 읽기전용으로 가져다 사용
  - 변경된 사항만 컨테이너 계층에 별도 저장
  - 하나의 이미지로 여러 컨테이너에서 사용가능

- 도커 허브(Docker Hub)

  - 중앙 이미지 저장소
  - 도커 계정 있으면 누구나 이미지 업로드/다운로드 가능
  - 기본적인 리눅스 운영체제부터 웹서버, 데이터베이스, 각종 애플리케이션 등의 다양한 종류의 이미지를 도커 레지스트리에서 내려 받아 컨테이너로 생성

- 도커 이미지 이름

  - **[저장소이름/]이미지이름[:태그]**
    - 저장소 이름 생략 -> 도커 허브 공식 이미지로 인식
    - 태그는 버전을 나타냄
    - 태그 생략 -> 최신 버전으로 인식

- 이미지 검색

  - docker search <키워드>

- 이미지 다운로드

  - docker pull [저장소이름/]<이미지이름>[:태그]

- 이미지 목록 조회

  - docker images

- 이미지 세부정보 조회

  - docker image inspect \<IMAGE ID>

- 이미지 추출

  - 도커 이미지를 별도의 파일로 저장할 때 사용
    - docker save -o <파일명> <이미지명>[:태그]
      - -o : 추출될 파일명을 지정
  - 추출된 파일을 다시 도커 내 이미지로 로드
    - docker load -i <파일명> 
      - -i  : 로드할 파일명을 지정
  
- 도커 이미지 이름 추가

  - docker tag [기존저장소/]<기존이미지명>[:기존태그]
  
    ​					[새로운저장소/]<새로운이미지명>[:새로운태그]
  
- 도커 이미지 삭제
  
  - docker rmi <이미지이름:태그 or IMAGE ID>



3. 도커 컨테이너 관리하기

- 도커 컨테이너
  - 도커 이미지의 실행 가능한 인스턴스
  - 개별 애플리케이션의 실행에 필요한 실행환경을 독립적으로 운용
- 컨테이너 생성
  - docker run [옵션] [저장소이름/]<이미지이름>[:버전]
    - -d : 백그라운드에서 컨테이너 실행
    - -i -t : 컨테이너 내부로 진입하여 컨테이너와 상호 입출력
    - --name <이름> : 컨테이너에 이름 지정(지정하지 않으면 16진수 임의값으로 이름 생성됨)
    - -p <호스트Port>:<컨테이너Port> : 외부에서 컨테이너 내부로 접근할 수 있게 호스트 PC의 포트와 컨테이너 내부 포트를 연결
    - -e <환경변수>=<값> : 환경변수 설정
    - --link : 다른 컨테이너에 링크 추가
- 컨테이너 확인
  - docker ps [옵션]

- 컨테이너 상세 내용 조회
  - docker inspect <컨테이너 이름 or ID>

- 컨테이너 실행/종료
  - **docker start/stop/restart <컨테이너 이름 or ID>**
- 컨테이너로 파일 복사
  - docker cp [옵션] <원본파일경로> <복사할경로>
    경로가 컨테이너 내부일 경우 \<컨테이너명:경로> 로 지정

- 컨테이너 명령어 실행

  - docker exec [옵션] <컨테이너이름 or ID> <명령어>

- 컨테이너 삭제

  - docker rm [옵션] <컨테이너이름 or ID> [컨테이너 이름 or ID ...]

  

4. DockerFile 다루기

- Dockerfile
  - 도커 이미지를 생성할 수 있는 설정 파일
- 도커 이미지 생성 방법 1
  - 기존 이미지로 컨테이너 생성 후 작업 완료된 컨테이너를 다시 이미
    지로 생성

- 도커 이미지 생성 방법 2

  - Dockerfile로 필요한 패키지, 소스코드, 명령어 등을 작성 후 빌드

- Dockerfile 명령어

  - FROM <이미지명>  

    - 생성할 이미지의 베이스가 될 이미지 Dockerfile 작성 시 반드시 한번 이상 입력해야 함 
    - 이미지 이름은 기본 도커 명령어에서 사용되는 형식과 동일 (저장소이름/이미지이름:태그)

  - LABEL \<"키:값"> 

    - 이미지에 메타 데이터 추가
    - "키:값" 형태로 입력
    - 여러 개의 메타데이터 입력 가능
    - docker inspect 명령어로 확인 가능

  - ADD <원본경로> <대상경로>

  - ADD ["추가할 파일명", ... , "추가될 위치"]

    - 로컬 디렉터리나 외부 URL 및 tar 파일에서 이미지로 파일 복사 
    - 기본 Dockerfile이 위치한 디렉터리에서 파일을 가져옴

    - JSON배열의 형태로 사용 가능
    - 추가할 파일명을 콤마(,)로 구분해서 나열한 뒤 가장 마지막에
    - 추가될 디렉터리 경로를 작성

  - COPY <원본경로> <대상경로>

    - 로컬 디렉터리에서 이미지로 파일을 복사

  - RUN <명령어>

  - RUN ["실행가능한 파일" , "명령줄 인자 1", "명령줄 인자2" ,... ]

    - 이미지를 만들기 위해 컨테이너 내부에서 실행할 명령어 입력
    - 명령어 실행 시 대화형 입력이 뜨지 않도록 옵션을 지정해야 함

  - WORKDIR <디렉터리> 

    - 명령어를 실행할 디렉터리로 이동
    - cd 명령어를 입력하는 것과 같은 기능

  - EXPOSE <포트번호> 

    - Dockerfile의 빌드로 생성된 이미지에서 사용될 포트 설정

  - CMD <명령어>

  - CMD ["실행가능한 파일", "명령줄 인자1", "명령줄 인자2", ...]

    - 컨테이너가 시작될 때 마다 실행할 명령어 설정
    - Dockerfile 에서 한번만 사용 가능
    - JSON배열 형태로 사용 가능

- Dockerfile 빌드
  - docker build [옵션] <Dockerfile이 존재하는 디렉터리 경로>
